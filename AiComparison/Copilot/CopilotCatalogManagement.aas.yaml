asyncapi: "3.0.0"
info:
  title: Catalog Management
  version: "2025-1"
  description: |
    Events produced by the Catalog Management bounded context.
    Domain events:
      - CatalogEntryCreated: emitted when a new catalog entry is created.
      - CatalogEntryChanged: emitted when an existing catalog entry is updated.
  contact:
    name: Annegret Junker
    email: annegret.junker@online-library.org
    url: https://apis.online-library.org/catalog-management
  x-api-id:
    71352c4f-16f4-4fae-abaf-331fcb28e354
  license:
    name: Apache 2.0
    url: https://www.apache.org/licenses/LICENSE-2.0.html
tags:
  - name: Catalog Management
    description: Events produced by Catalog Management

servers:
  event-broker-library:
    url: broker.online-library.org:8092
    protocol: kafka
    description: Event broker of the online library
    bindings:
      kafka:
        schemaRegistryUrl: 'https://online-library-schema-registry.com'
        schemaRegistryVendor: 'confluent'
        bindingVersion: '0.5.0'
    security:
      - user-password: []

channels:
  catalog.entry.created:
    description: Channel for newly created catalog entries
    publish:
      operationId: CatalogEntryCreatedSend
      summary: Event sent when a catalog entry is created
      message:
        $ref: '#/components/messages/CatalogEntryCreated'
      bindings:
        kafka:
          topic: 'catalog.entry.created'
          bindingVersion: '0.5.0'
          key:
            type: string
            format: uuid
            description: catalogEntryId used as Kafka message key
    bindings:
      kafka:
        bindingVersion: '0.5.0'

  catalog.entry.changed:
    description: Channel for modified catalog entries
    publish:
      operationId: CatalogEntryChangedSend
      summary: Event sent when a catalog entry is changed
      message:
        $ref: '#/components/messages/CatalogEntryChanged'
      bindings:
        kafka:
          topic: 'catalog.entry.changed'
          bindingVersion: '0.5.0'
          key:
            type: string
            format: uuid
            description: catalogEntryId used as Kafka message key
    bindings:
      kafka:
        bindingVersion: '0.5.0'

components:
  securitySchemes:
    user-password:
      type: userPassword
      description: Security scheme for events

  messages:
    CatalogEntryCreated:
      name: CatalogEntryCreated
      title: Catalog Entry Created Event
      summary: New catalog entry created by the Catalog Management service
      headers:
        $ref: '#/components/schemas/MessageHeader'
      payload:
        $ref: '#/components/schemas/CatalogEntryFull'

    CatalogEntryChanged:
      name: CatalogEntryChanged
      title: Catalog Entry Changed Event
      summary: Catalog entry changed; consumers should synchronize search and recommendations
      headers:
        $ref: '#/components/schemas/MessageHeader'
      payload:
        $ref: '#/components/schemas/CatalogEntryFull'

  schemas:
    MessageHeader:
      description: Header information for each message
      type: object
      required:
        - correlationId
        - messageId
        - x-api-identifier
        - x-api-version
        - source
      properties:
        correlationId:
          type: string
          format: uuid
          description: Identifier to trace end-to-end journey
        messageId:
          type: string
          format: uuid
          description: Identifier for the particular message
        x-api-identifier:
          type: string
          format: uuid
          description: Identifier of the API used to create the message
          default: 71352c4f-16f4-4fae-abaf-331fcb28e354
        x-api-version:
          type: string
          description: Version of the API
          default: "2025-1"
        source:
          type: string
          description: Application name creating the message
          examples:
            - CatalogManagement

    CatalogEntryFull:
      description: Full representation of a catalog entry and its bibliographic metadata
      type: object
      required:
        - catalogEntryId
        - title
        - authors
      properties:
        catalogEntryId:
          description: Identifier of the catalog entry
          type: string
          format: uuid
          examples:
            - 5dda405a-d28e-490a-8508-1ea3453e91ae
        createdAt:
          description: Creation timestamp
          type: string
          format: date-time
        updatedAt:
          description: Last update timestamp
          type: string
          format: date-time
        catalogId:
          description: Identifier of the catalog containing the entry
          type: string
          format: uuid
        title:
          $ref: '#/components/schemas/Title'
        subtitle:
          type: string
        authors:
          description: List of authors
          type: array
          minItems: 1
          items:
            $ref: '#/components/schemas/Author'
        editors:
          description: List of editors if any
          type: array
          items:
            $ref: '#/components/schemas/Editor'
        isbn:
          $ref: '#/components/schemas/ISBN'
        publisher:
          $ref: '#/components/schemas/Publisher'
        abstract:
          $ref: '#/components/schemas/Abstract'
        tags:
          description: Tags or keywords associated with the entry
          type: array
          items:
            $ref: '#/components/schemas/Tag'
        mediaUrl:
          description: Link to associated digital content or media
          type: string
          format: uri
        format:
          description: Format of the media
          type: string
          x-extensible-enum:
            - EPUB
            - KINDLE
            - PDF
            - MOBI
            - AUDIO
        language:
          type: string
          description: ISO 639-1 language code
          example: de

    Title:
      description: Title object
      type: object
      required:
        - text
      properties:
        text:
          type: string
          minLength: 1
        subtitle:
          type: string

    Author:
      description: Author of a book
      type: object
      required:
        - authorId
        - familyName
      properties:
        authorId:
          type: string
          format: uuid
        givenName:
          type: string
        familyName:
          type: string
        affiliation:
          type: string

    Editor:
      description: Editor of a book
      type: object
      required:
        - name
      properties:
        name:
          type: string
        city:
          type: string

    Publisher:
      description: Publisher of the book
      type: object
      properties:
        publisherId:
          type: string
          format: uuid
        name:
          type: string
        city:
          type: string

    ISBN:
      description: ISBN identifier (13 preferred)
      type: object
      properties:
        isbn13:
          type: string
          pattern: ^(?:ISBN(?:-13)?:?\ )?(?=[0-9]{13}$|(?=(?:[0-9]+[-\ ]){4})[-\ 0-9]{17}$)97[89][-\ ]?[0-9]{1,5}[-\ ]?[0-9]+[-\ ]?[0-9]+[-\ ]?[0-9]$
        isbn10:
          type: string

    Abstract:
      description: Short abstract or summary
      type: object
      properties:
        text:
          type: string
        language:
          type: string

    Tag:
      description: Keyword or tag assigned to a catalog entry
      type: object
      required:
        - name
      properties:
        tagId:
          type: string
          format: uuid
        name:
          type: string

    CatalogShort:
      description: Catalog container
      type: object
      properties:
        catalogId:
          type: string
          format: uuid
        name:
          type: string
        createdAt:
          type: string
          format: date-time

  parameters:
    catalogEntryId:
      description: Identifier for a catalog entry
      schema:
        type: string
        format: uuid

  schemas_examples:
    exampleCatalogEntry:
      catalogEntryId: 5dda405a-d28e-490a-8508-1ea3453e91ae
      createdAt: "2025-09-30T12:00:00Z"
      updatedAt: "2025-10-01T08:30:00Z"
      catalogId: 9a3b2f88-1c3d-4e2a-8f9a-0d2b8c3f4a11
      title:
        text: Test-Driven Development
      authors:
        - authorId: 08a13654-05f3-4664-8c8d-fdd9114ec3be
          givenName: Kent
          familyName: Beck
      isbn:
        isbn13: 9780321146530
      tags:
        - tagId: 11111111-2222-3333-4444-555555555555
          name: testing
